<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>PNG Compressor (Lossless) | webpng</title>
    <link rel="stylesheet" href="styles.css?v=6" />
  </head>
  <body>
    <!-- Header / nav -->
    <header>
      <nav>
        <span class="brand">webpng</span>
        <a class="pill" href="/index.html">Home</a>
        <a class="pill" href="/about.html">About</a>
        <a class="pill" href="/privacy.html">Privacy</a>
        <a class="pill" href="/terms.html">Terms</a>
        <a class="pill" href="/contact.html">Contact</a>
      </nav>
    </header>

    <div class="wrap">
      <h1>PNG Compressor (Lossless)</h1>
      <div class="sub">
        Reduce PNG size by stripping metadata &amp; repacking — all in your
        browser.
      </div>

      <!-- Tool card -->
      <div class="card">
        <input id="file" type="file" accept="image/png" />
        <p class="note" style="margin-top: 8px">
          All processing happens in your browser. Nothing is uploaded.
        </p>

        <div class="row" style="margin-top: 12px">
          <button class="btn" id="go" disabled>Compress</button>
          <a id="dl" class="btn secondary" download hidden>Download</a>
        </div>

        <div class="kv">
          <span>Dimensions</span><span id="dims">—</span>
          <span>Original size</span><span id="orig">—</span>
          <span>Compressed size</span><span id="comp">—</span>
        </div>

        <div class="canvasWrap" style="margin-top: 10px">
          <canvas id="c" style="display: none; max-width: 100%"></canvas>
        </div>
      </div>

      <!-- Info / FAQ card -->
      <div class="card" style="margin-top: 16px">
        <h2 style="margin-top: 0">About PNG compression</h2>

        <details open>
          <summary>What does this PNG Compressor do?</summary>
          <p>
            This tool performs a <b>lossless recompression</b> of PNG images. It
            removes unnecessary metadata and repacks the image to reduce file
            size without changing pixels or transparency. Ideal for logos,
            icons, UI assets, and pixel‑perfect graphics.
          </p>
        </details>

        <details>
          <summary>Why compress PNGs?</summary>
          <ul>
            <li>Reduce file size (often 10–40%) with no visual change.</li>
            <li>Speed up page loads and improve Core Web Vitals.</li>
            <li>Keep alpha transparency intact for UI and graphics.</li>
          </ul>
        </details>

        <details>
          <summary>Tips</summary>
          <ul>
            <li>
              Use PNG for logos, line art, screenshots, or graphics needing
              transparency.
            </li>
            <li>
              For photos/illustrations, try
              <a href="/jpg-to-webp.html">JPG → WebP</a> for much smaller files.
            </li>
          </ul>
        </details>

        <details>
          <summary>FAQ</summary>
          <p>
            <b>Q:</b> Is the compression truly lossless?<br />
            <b>A:</b> Yes — pixels remain identical; we mainly remove metadata
            and re‑encode efficiently.
          </p>
          <p>
            <b>Q:</b> Can I compress multiple times?<br />
            <b>A:</b> After the first pass, additional gains are usually
            minimal.
          </p>
        </details>
      </div>

      <!-- Footer -->
      <footer class="sub" style="margin-top: 18px">
        © <span id="y"></span> webpng · <a href="/privacy.html">Privacy</a> ·
        <a href="/terms.html">Terms</a>
      </footer>
    </div>

    <script>
      document.getElementById("y").textContent = new Date().getFullYear();

      const file = document.getElementById("file");
      const go = document.getElementById("go");
      const dl = document.getElementById("dl");
      const c = document.getElementById("c");
      const ctx = c.getContext("2d");
      const dims = document.getElementById("dims");
      const orig = document.getElementById("orig");
      const comp = document.getElementById("comp");

      let selectedFile = null;
      let originalSize = 0;
      let baseName = "image";

      const bytes = (n) => {
        if (!Number.isFinite(n)) return "—";
        const k = 1024,
          u = ["KB", "MB", "GB"];
        if (n < k) return n + " B";
        let i = -1;
        do {
          n /= k;
          ++i;
        } while (n >= k && i < u.length - 1);
        return n.toFixed(1) + " " + u[i];
      };

      file.addEventListener("change", async (e) => {
        const f = e.target.files[0];
        if (!f) {
          go.disabled = true;
          return;
        }
        if (!/\.png$/i.test(f.name)) {
          alert("Please choose a PNG file.");
          go.disabled = true;
          return;
        }

        selectedFile = f;
        originalSize = f.size;
        orig.textContent = bytes(originalSize);
        baseName = (f.name || "image").replace(/\.[^/.]+$/, "");
        dl.download = baseName + ".png";
        dl.hidden = true;
        comp.textContent = "—";
        c.style.display = "none";

        const img = new Image();
        img.src = URL.createObjectURL(f);
        await img.decode();
        c.width = img.naturalWidth;
        c.height = img.naturalHeight;
        ctx.clearRect(0, 0, c.width, c.height);
        ctx.drawImage(img, 0, 0);
        dims.textContent = `${img.naturalWidth} × ${img.naturalHeight}`;
        go.disabled = false;
      });

      go.addEventListener("click", async () => {
        if (!selectedFile) {
          alert("Choose a PNG first");
          return;
        }
        const blob = await new Promise((res) => c.toBlob(res, "image/png"));
        if (!blob) {
          alert("Compression failed.");
          return;
        }

        c.style.display = "block";
        comp.textContent = bytes(blob.size);

        const url = URL.createObjectURL(blob);
        dl.href = url;
        dl.hidden = false;

        // Reset input after preparing download
        file.value = "";
        selectedFile = null;
        go.disabled = true;

        // Optional full reset after enabling Download:
        dims.textContent = "—";
        orig.textContent = "—";
        comp.textContent = "—";
        c.style.display = "none";
      });
    </script>
  </body>
</html>
